<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Price Prediction - Results</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <nav>
        <div class="logo">üí∞ CryptoPredict</div>
        <div class="nav-links">
            <a href="/">Home</a>
            <a href="/about">About</a>
            <a href="/health">Health</a>
        </div>
    </nav>

    <div class="container">
        {% if prediction.success %}

        <div class="text-center mb-4">
            <h1 class="price-large">
                <span class="{% if prediction.price_change > 0 %}trend-up{% else %}trend-down{% endif %}">
                    {% if prediction.price_change > 0 %}‚ñ≤{% else %}‚ñº{% endif %}
                </span>
                ${{ "%.2f"|format(prediction.predicted_price) }}
            </h1>
            <p style="font-size: 1.2rem;">Predicted Price Target</p>
        </div>

        <div class="grid-3">
            <div class="card">
                <h3>üìä Current Price</h3>
                <div style="font-size: 1.8rem; font-weight: 700;">${{ "%.2f"|format(prediction.current_price) }}</div>
                <p>Real-time Market Data</p>
            </div>

            <div class="card">
                <h3>üíπ Price Change</h3>
                <div style="font-size: 1.8rem; font-weight: 700;"
                    class="{% if prediction.price_change > 0 %}trend-up{% else %}trend-down{% endif %}">
                    {% if prediction.price_change > 0 %}+{% endif %}${{ "%.2f"|format(prediction.price_change) }}
                </div>
                <p>{% if prediction.price_change > 0 %}+{% endif %}{{ "%.2f"|format(prediction.price_change_pct) }}%
                    Forecast</p>
            </div>

            <div class="card">
                <h3>üéØ Confidence</h3>
                <div style="font-size: 1.8rem; font-weight: 700;">{{ "%.1f"|format(prediction.confidence) }}%</div>
                <div class="confidence-meter">
                    <div id="confidenceFill" class="confidence-fill"></div>
                </div>
            </div>
        </div>

        <!-- Chart Section -->
        <div class="card mb-4">
            <h3>üìà Price Trend & Prediction</h3>
            <div class="chart-container">
                <canvas id="priceChart"></canvas>
            </div>
        </div>

        <div class="grid-2">
            <!-- Model Details -->
            <div class="card">
                <h3>ü§ñ Model Breakdown</h3>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    {% for model_name, price in prediction.all_predictions.items() %}
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 0.5rem; border-bottom: 1px solid var(--glass-border);">
                        <span style="text-transform: capitalize; color: var(--primary);">{{ model_name.replace('_', ' ')
                            }}</span>
                        <span style="font-weight: 600;">${{ "%.2f"|format(price) }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Disclaimer -->
            <div class="card" style="border-color: rgba(245, 158, 11, 0.3);">
                <h3 style="color: var(--warning);">‚ö†Ô∏è Disclaimer</h3>
                <p style="font-size: 0.9rem; line-height: 1.6;">
                    This prediction is for educational and research purposes only.
                    Cryptocurrency markets are highly volatile. Do not make financial decisions based
                    solely on these predictions. Always conduct thorough research and consult with financial advisors.
                </p>
                <div class="mt-4" style="font-size: 0.8rem; opacity: 0.6;">
                    Data Points: {{ prediction.data_points }} | Updated: {{ prediction.last_update }}
                </div>
            </div>
        </div>

        <div class="text-center mt-4" style="display: flex; gap: 1rem; justify-content: center;">
            <button class="btn btn-primary" onclick="history.back()">‚Üê New Prediction</button>
            <button class="btn btn-outline" onclick="location.reload()">üîÑ Refresh Data</button>
        </div>

        <!-- Pass data to JS -->
        <script>
            try {
                // Safely parse JSON data from backend
                const historicalDates = {{ prediction.historical_data.dates | tojson
            }};
            const historicalPrices = {{ prediction.historical_data.prices | tojson }};
            const predictedPrice = {{ prediction.predicted_price }};

            // Set confidence meter width dynamically
            const confidenceFill = document.getElementById('confidenceFill');
            if (confidenceFill) {
                confidenceFill.style.width = "{{ prediction.confidence }}%";
            }

            if (historicalDates && historicalPrices) {
                window.chartData = {
                    labels: historicalDates.concat(['Prediction']),
                    historical: historicalPrices.concat([null]),
                    prediction_point: new Array(historicalPrices.length).fill(null).concat([predictedPrice])
                };
            }
            } catch (e) {
                console.error("Error initializing chart data:", e);
            }
        </script>

        {% else %}

        <div class="card" style="border-color: var(--danger); text-align: center;">
            <h3 style="color: var(--danger);">‚ùå Prediction Failed</h3>
            <p>{{ prediction.error }}</p>
            <button class="btn btn-primary mt-4" onclick="history.back()">‚Üê Try Again</button>
        </div>

        {% endif %}
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>